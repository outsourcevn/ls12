@using WebTMDT.Models;
@using WebTMDT.Helpers;
@using PagedList;
@using PagedList.Mvc;
<link href="~/Content/PagedList.css" rel="stylesheet" type="text/css" />
<script src="~/Content/Theme/1a/Plugin/jquery.number.min.js"></script>

@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_LayoutProduct.cshtml";
}

<div class="content-heading text-center">
    <!-- Input Your Home Content Here -->
    <div class="row text-center">
        <!-- contact form outer row with centered text-->
        <h2>Tìm kiếm sản phẩm</h2>
        <div class="col-md-12">
            <!-- col 10 with offset 1 to centered -->
            @Html.Partial("~/Views/Home/_SearchPartial.cshtml")
        </div><!-- end col 10 with offset 1 to centered -->
    </div> <!-- end contact form outer row with centered text-->


</div><!-- End Input Your Home Content Here -->

<div class="form-horizontal" id="search_option">
    <div class="form-group">
        <div class="col-md-3">
            @if (ViewBag.ProductTheLoai != null)
            {
                @Html.DropDownList("SelectTheLoai", new SelectList(ViewBag.ProductTheLoai, "ProductTypeName", "ProductTypeName"), "Chọn thể loại sản phẩm", new { @class = "form-control" })
            }
        </div>
        <div class="col-md-3">
            @if (ViewBag.ProductTrangThai != null)
            {
                @Html.DropDownList("SelectTinhTrang", new SelectList(ViewBag.ProductTrangThai, "ProductStatusName", "ProductStatusName"), "Chọn tình trạng sản phẩm", new { @class = "form-control" })
            }
        </div>
        <div class="col-md-3">
            @if (ViewBag.ProductNgayDang != null)
            {
                @Html.DropDownList("SelectNgayDang", new SelectList(ViewBag.ProductNgayDang, "TypeSort", "NameSort"), "Ngày đăng", new { @class = "form-control" })
            }
        </div>
        <div class="col-md-3">
            @if (ViewBag.ProductGiaBan != null)
            {
                @Html.DropDownList("SelectGiaBan", new SelectList(ViewBag.ProductGiaBan, "TypeSort", "NameSort"), "Giá bán", new { @class = "form-control" })
            }
        </div>
    </div>
</div>



<div class="row">
    <div class="col-md-12">

        @if (ViewBag.Product != null)
        {
            foreach (var item in ViewBag.Product)
            {
                <div class="row product">
                    <div class="col-xs-12 col-md-3">
                        <div class="thumbnail">
                            <a href="@string.Format("/{0}/{1}/{2}-{3}.html", @item.DanhMucCha, @item.DanhMucCon, @item.slugTenSp, @item.SanPhamId)">
                                <img src="@item.AnhSanPham" alt="@item.TenSp" class="img-responsive">
                            </a>
                        </div>
                    </div>
                    <div class="col-xs-12 col-md-9">
                        <div class="row">
                            <div class="col-sm-12">
                                <h3><a href="@string.Format("/{0}/{1}/{2}-{3}.html", @item.DanhMucCha, @item.DanhMucCon, @item.slugTenSp, @item.SanPhamId)">@item.TenSp</a></h3>
                                <p><b>Tình trạng: </b> @item.TinhTrangSp</p>
                                <p><b>Ngày đăng: </b>@item.NgayDang</p>
                                <p><b>Thể loại: </b> @item.TheLoai</p>
                                <p><b>Tên cửa hàng: </b><a href="@string.Format("/gianhang/{0}/{1}", @item.gianhang, @item.SlugGianHang)">@item.TenNguoiBan</a></p>
                                <p class="giaban">@item.GiaBan</p>
                                <p class="sodienthoai"><a href="tel:@item.SoDienThoaiNgBan">@item.SoDienThoaiNgBan</a></p>
                            </div>
                        </div>

                    </div>
                </div>

            }

            <script>
                $('.giaban').append($('.giaban').number(true, 0, '.', '.')).append(" Đồng.");
            </script>
            <div class="row phantrang">
                @Html.PagedListPager((IPagedList)ViewBag.Product, page => Url.Action("Search", new { ParentId = ViewBag.ParentCatIdFirst, CategoryId = ViewBag.CatIdFirst, SubCategoryId = ViewBag.SubCatIdFirst, LocalId = ViewBag.LocalId, TheLoai = ViewBag.TheLoai, TinhTrang = ViewBag.TinhTrang, NgayDang = ViewBag.NgayDang, giaban = ViewBag.GiaBan, page = page }), PagedListRenderOptions.OnlyShowFivePagesAtATime)
            </div>
        }
        else
        {
            <span>Không có sản phẩm nào.</span>
        }
    </div>

</div>


<script>
    $(document).ready(function () {
        $('#SelectTheLoai').change(function () {
            $('input#TheLoai').tagsinput('removeAll');
            $('input#TheLoai').tagsinput('add', $(this).val());
            if ($(this).val() !== "") {
                $('#form-search').submit();
            }
        });
        $('#SelectTinhTrang').change(function () {
            $('input#TinhTrang').tagsinput('removeAll');
            $('input#TinhTrang').tagsinput('add', $(this).val());
            if ($(this).val() !== "") {
                $('#form-search').submit();
            }
        });

        $('#SelectNgayDang').change(function () {
            $('input#NgayDang').val($(this).val());
            $('input#GiaBan').val('');
            if ($(this).val() !== "") {
                $('#form-search').submit();
            }
        })
        $('#SelectGiaBan').change(function () {
            $('input#NgayDang').val('');
            $('input#GiaBan').val($(this).val());
            if ($(this).val() !== "") {
                $('#form-search').submit();
            }
        })

      

        $('input.input_search').on('beforeItemRemove', function (event) {
            var tag = event.item;
            // Do some processing here

            if (!event.options || !event.options.preventPost) {
                $(this).tagsinput('removeAll');
                $('#form-search').submit();
            }
        });

        $('input.input_option').on('beforeItemRemove', function (event) {
            var tag = event.item;
            // Do some processing here

            if (!event.options || !event.options.preventPost) {
                $(this).tagsinput('removeAll');
                $('#form-search').submit();
            }
        });

        


    });
</script>

@*<div id="clickme">click me</div>
    <script>
        $('#clickme').click(function () {
            $('#btn-timkiem').click();

        })
    </script>*@